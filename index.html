<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LeanCloud å®æ—¶ç•™è¨€æ¿</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-bottom: 10px; }
    .msg { margin: 5px 0; }
    #name, #message { width: 100%; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>ç•™è¨€æ¿ï¼ˆLeanCloud å®æ—¶åŒæ­¥ï¼‰</h2>
  <div id="messages"></div>
  <input type="text" id="name" placeholder="ä½ çš„åå­—">
  <textarea id="message" placeholder="å†™ç‚¹ä»€ä¹ˆ..." rows="3"></textarea>
  <button onclick="sendMessage()">å‘é€</button>

  <!-- LeanCloud SDK -->
  <script src="https://unpkg.com/leancloud-realtime/dist/realtime.browser.min.js"></script>

  <script>
    // ğŸš¨ æ›¿æ¢æˆä½ è‡ªå·±çš„ LeanCloud AppID å’Œ AppKey
    const APP_ID = 'IwogPISVgDBTZFveD6orVyv4-gzGzoHsz';
    const APP_KEY = 'tSvZWkAoXJGUwNydArLF5u0z';

    const clientId = 'user-' + Math.floor(Math.random() * 100000); // è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€å®¢æˆ·ç«¯å

    const { Realtime } = AV;
    const realtime = new Realtime({
      appId: APP_ID,
      appKey: APP_KEY,
      region: 'cn', // å›½å†…
    });

    let messageList = document.getElementById('messages');
    let conversation;

    realtime.createIMClient(clientId).then(client => {
      return client.createConversation({
        name: 'ç•™è¨€æ¿',
        members: [], // å•èŠå¤©å®¤
        unique: true
      });
    }).then(c => {
      conversation = c;
      conversation.queryMessages({ limit: 100 }).then(messages => {
        messages.forEach(msg => addMessage(msg));
      });
      conversation.on('message', addMessage);
    }).catch(console.error);

    function addMessage(message) {
      const div = document.createElement('div');
      div.className = 'msg';
      const from = message.from || 'åŒ¿å';
      div.textContent = `[${from}] ${message.text}`;
      messageList.appendChild(div);
      messageList.scrollTop = messageList.scrollHeight;
    }

    function sendMessage() {
      const name = document.getElementById('name').value || 'åŒ¿å';
      const text = document.getElementById('message').value.trim();
      if (!text) return;
      conversation.send(new AV.TextMessage(text), { transient: false }).then(() => {
        document.getElementById('message').value = '';
      });
    }
  </script>
</body>
</html>
